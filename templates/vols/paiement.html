{% extends 'base2.html' %}
{% load static %}
{% block maincontent %}

{% comment %} {% if messages %}
<div class="alert alert-success text-center" id="alert-msg">
  {% for message in messages %}
  <h3>{{ message }}</h3>
  {% endfor %}
</div>
{% endif %}  {% endcomment %}

<link href="{% static 'amadeuspro/css/style.css' %}" rel="stylesheet">
<link href="{% static 'amadeuspro/css/card.css' %}" rel="stylesheet">



{% comment %} <div class="inner-banner">
  <div class="container">
    <div class="row">
      <div class="col-md-7">
        <h1>Reserver et Payer</h1>
      </div>
      <div class="col-md-5">
        <ol class="breadcrumb">
          <li><a href="{% url 'indexpage' %}">Acceuil</a></li>
          <li class="active">Reservation</li>
        </ol>
      </div>
    </div>
  </div>
</div> {% endcomment %}


<div class="container-fluid">
  <div class="row mtop30">
    <h2 class='text-center'>Payer votre reservation avec nos partenaires</h2>
    <br>
    <div class="col-md-12">
      <div class='col-md-1 col-md-offset-1'>
        <img src="/media/operateurs/orangemoney.jpg" class='img img-thumbnail img-circle img-responsive' style='inline-size:190px; block-size:150px;'>
      </div>
      <div class='col-md-1 col-md-offset-2'>
        <img src="/media/operateurs/paypal.png" class='img img-thumbnail img-circle img-responsive' style='inline-size:190px; block-size:150px;'>
      </div>
      <div class='col-md-1 col-md-offset-2'>
        <img src="/media/operateurs/stripe.png" class='img img-thumbnail img-circle img-responsive' style='inline-size:190px; block-size:150px;'>
      </div>
      <div class='col-md-1 col-md-offset-2'>
        <img src="/media/operateurs/wave.jpeg" class='img img-thumbnail img-circle img-responsive' style='inline-size:190px; block-size:150px;'>
      </div>
    </div>
  </div>
  <div class="row">

  <div class="col-md-6">
    <div class="card mtop30 ">
      <div class="card-header bg-info "><h1 class='text-danger'>Fiche de Reservation <i class="fa fa-calendar"></i></h1></div>
      <div class="card-body">
  <!-- Contact Details -->
  {% if user.is_authenticated %}
      <fieldset class="first-section">
        <legend class='text-center'><h3 class='text-info'>Details du Client <i class='fa fa-user'></i></h3></legend>

        <div class="input-group input-group-lg" hidden>
          <span class='pull-right' style='padding-inline-start: 120px;' hidden><h3 id='useridcl' hidden>{{ user.id}} </h3></span>
        </div>

        <div class="input-group input-group-lg">
          <span class='badge badge-danger pull-left'><h3>Utilisateur</h3></span> 
          <span class='pull-right' style='padding-inline-start: 120px;'><h3 id='user'>{{ user.username}} </h3></span>
        </div>
        <br>
        
        <div class="input-group input-group-lg">
          <span class='badge badge-danger pull-left'><h3>Nom Complet</h3></span> 
          <span class='pull-right' style='padding-inline-start: 50px;'><h3 id='nomComplet'>{{ user.first_name}}    {{ user.last_name}}</h3></span>
        </div>
        <br>

        <div class="input-group input-group-lg">
          <span class='badge badge-danger pull-left'><h3>Mail</h3></span> 
          <span class='pull-right' style='padding-inline-start: 120px;'><h3 id='mailuser'>{{ user.email}} </h3></span>
        </div>


      </fieldset>
    {% else %}
    <div class="alert alert-success" id="alert-msg">
      <p>Se connecter pour reserver</p>
    </div>
    {% endif %}

      
      {% csrf_token %}
      <br>
      <fieldset class="second-section">
        <legend class='text-center'> <h3 class='text-info'> Details du Vol <i class='fa fa-plane'></i></h3></legend>

        <div class="input-group">
          <span class='badge badge-danger pull-left'><h3>Numero Vol</h3></span> 
          <span class='pull-right' style='padding-inline-start: 130px;'><h3 id='numvol'>{{ numvol}} </h3></span>
          </div>
        <br>

        <div class="input-group">
          <span class='badge badge-danger pull-left'><h3>Heure depart</h3></span> 
          <span class='pull-right' style='padding-inline-start: 120px;'><h3 id='hdpt'>{{ hdpt}} </h3></span>
        </div>
        <br>

        <div class="input-group">
          <span class='badge badge-danger pull-left'><h3>Heure arrivee</h3></span> 
          <span class='pull-right' style='padding-inline-start: 120px;'><h3 id='harriv'>{{ harriv}} </h3></span>
        </div>
        <br>

        <div class="input-group">
          <span class='badge badge-danger pull-left'><h3>Sieges disponibles</h3></span> 
          <span class='pull-right' style='padding-inline-start: 120px;'><h3 id='siegedisponib'>{{ siegedispo}} </h3></span>
          
        </div>
        <br>

      </fieldset>


      <!-- Personal Information -->
      <fieldset class="second-section">
        <legend class='text-center'><h3 class='text-info'> Espace Passager </h3><h4 class='text-danger'>**Veuiller dabord selectionner un passager pour activer le bouton de paiement</h4></legend>

        <div class="input-group">
          <span class='badge badge-danger pull-left'><h3>Nombre de Passagers</h3></span> 
          <span class='pull-right' style='padding-inline-start: 120px;'><select class="form-control form-select" id="passager-select"></select>
          </span>
          
        </div>

        <script>
          var siegedispo = {{ siegedispo }};  // Récupérer la valeur depuis Django
          var selectElement = document.getElementById("passager-select");

          for (var i = 1; i <= siegedispo; i++) {
            var optionElement = document.createElement("option");
            optionElement.value = i;
            optionElement.text = i;
            selectElement.appendChild(optionElement);
          }

         
           
        </script>

  
      </fieldset>

      <div class='btn-group-lg mtop30'>
        {% comment %} <button class='btn btn-warning'>Annuler</button> {% endcomment %}
      {% comment %} <button class='btn btn-success'>Valider la Reservation</button> {% endcomment %}
      </div>
     </div>
    </div>
  </div>

  {% comment %} PAIEMENT {% endcomment %}
  <div class="col-md-4">
    <div class="card mtop30">
      <div class="card-header bg-success"><h1 class='text-success'>Paiement <i class="fa fa-bank"></i></h1></div>
      <div class="card-body">
        <form method='POST' action="{% url 'reserverVOYAGE' %}">
          {% csrf_token %} 
        <fieldset class="first-section">
          <input type="hidden"  id="hideuserid" name="useridclt" value="">
          <input type="hidden"  id="hideuser" name="user" value="">
          <input type="hidden"  id="hideclt" name="client" value="">
          <input type="hidden"  id="hidemail" name="emailClient" value="">
          <input type="hidden"  id="hidenumvol" name="numvol" value="">
          <input type="hidden"  id="hidehdpt" name="hdpt" value="">
          <input type="hidden"  id="hidearr" name="harr" value="">
          <input type="hidden"  id="hidesdisp" name="sdisp" value="">
          <input type="hidden"  id="hideprice" name="pricing" value="">
          <input type="hidden"  id="hidesiegeres" name="sres" value="">  


        <div class="input-group">
            <span class='badge badge-inverse pull-left'><h3>Montant</h3></span> 
            <span class='pull-right' style='padding-inline-start: 150px;'><b><h1 id='price-div'>{{ prix }}<span id='currencyshow' class='text-danger'></span></h1></b></span>
        </div>
        <br><br>
        <div class="input-group input-group-lg">
          <span class='badge badge-danger pull-left'><h3>Devise paiement</h3></span>
          <span class='pull-right' style='padding-inline-start: 80px;'>
            <select class="form-control form-select" name='devise' id='devise' >
            <option value="€" selected>EUROS</option>
            <option value="$">DOLLARDS</option>
            <option value="£">LIVRES</option>
            </select>
          </span>
        </div>
        
        <br><br>
        <div class="input-group">
          <span class='badge badge-danger pull-left'><h3>operateurs</h3></span>
          <span class='pull-left' style='padding-inline-start: 10px;'>
              <input type="radio" name="payment-method" value="bank" id="bank-radio" checked>
              <label for="bank-radio">Bank</label>
              <input type="radio" name="payment-method" value="operator" id="operator-radio">
              <label for="operator-radio">Operator</label>
          </span>

          <span class='pull-right' style='padding-inline-start: 10px;'>
              <div id="bank-select">
                <select id="bank-options"  class='form-control form-select' name='bank'>
                  <option value="bank1">PayPal</option>
                  <option value="bank2">Ecobank</option>
                  <option value="bank3">SGBS</option>
                </select>
              </div>

              <div id="operator-select" style="display: none;" class='form-control form-select'>
                <select id="operator-options">
                  <option value="orangemoney">Orange money</option>
                  <option value="free">Free</option>
                  <option value="paypal">PayPal</option>
                  <option value="stripe">Stripe</option>
                </select>
              </div>

            </span>


          </span>
        </div>
        
      </fieldset>
      <br><br>
      <center>
      <button id='reserve-button' class='submit-btn' id='validerpaiement'><h3 class='text-light'>Valider le Paiement</h3></button>
      </center>
    </form>
     </div>
    </div>
  </div>
</div>

<br><br>

</div>

<br><br>
<script>
  document.getElementById("reserve-button").style.display='none';
  // Get the select element and price div
  var selectElement = document.getElementById("passager-select");
  var priceDiv = document.getElementById("price-div");
  const prix = priceDiv.innerHTML;
  // Add an event listener to the select element
  selectElement.addEventListener("change", function() {
    // Get the selected value
  document.getElementById("reserve-button").style.display='block';
    var selectedValue = selectElement.value;
    // Perform calculations based on the selected value
    var price = selectedValue * parseFloat(prix);

    // Update the price in the div
    priceDiv.innerHTML = price;
  });

var dev = document.getElementById("devise");
var devisecontainer = document.getElementById("currencyshow");
dev.addEventListener("change", function() {
  var selectedV = dev.value;
  devisecontainer.innerHTML = selectedV;
});
</script>

<script>

  var bankRadio = document.getElementById('bank-radio');
  var operatorRadio = document.getElementById('operator-radio');
  var bankSelect = document.getElementById('bank-select');
  var operatorSelect = document.getElementById('operator-select');

  bankRadio.addEventListener('change', function() {
    bankSelect.style.display = 'block';
    operatorSelect.style.display = 'none';
  });

  operatorRadio.addEventListener('change', function() {
    bankSelect.style.display = 'none';
    operatorSelect.style.display = 'block';
  });


</script>

<script>


{% comment %} <script>
  $(document).ready(function() {
    // Add an event listener to the button
    $('#reserve-button').on('click', function() {
      // Assuming you have retrieved the values and stored them in variables
      var passengerName = "{{prix}}" ;
      alert(passenger_name);
      var seatNumber = "A1";
      var flightId = 12345;
  
      // Create a data object with the values
      var data = {
        passenger_name: vol,
        seat_number: seatNumber,
        flight_id: flightId
      };
  
      // Send an AJAX POST request to your Django view
      $.ajax({
        url: "{% url 'reserver' %}",  // Replace with your Django view URL
        method: 'POST',
        data: data,
        success: function(response) {
          // Handle the success response, if needed
          console.log(response);
        },
        error: function(xhr, status, error) {
          // Handle the error, if needed
          console.log(error);
        }
      });
    });
  }); {% endcomment %}
  window.onload = function() {
    var userid = document.getElementById('useridcl').innerText;
    var user = document.getElementById('user').innerText;
    var nomC = document.getElementById('nomComplet').innerText;
    var mailC = document.getElementById('mailuser').innerText;
    var numvolValue = document.getElementById('numvol').innerText;
    var heurdpt = document.getElementById('hdpt').innerText;
    var har = document.getElementById('harriv').innerText;
    var sd = document.getElementById('siegedisponib').innerText;
    let selectElement = document.getElementById('passager-select')
    document.getElementById('hideuserid').value =  userid;
    document.getElementById('hideuser').value = user;
    document.getElementById('hideclt').value = nomC;
    document.getElementById('hidemail').value = mailC;
    document.getElementById('hidenumvol').value = numvolValue;
    document.getElementById('hidehdpt').value = heurdpt;
    document.getElementById('hidearr').value = har;
    document.getElementById('hidesdisp').value = sd;
    selectElement.addEventListener("change", function() {
      var pricerecup = document.getElementById('price-div').innerText;
      document.getElementById('hideprice').value = pricerecup;
      document.getElementById("hidesiegeres").value = selectElement.value;
    });
    
  };

</script>

{% endblock maincontent %}